<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Complete Audio Diagnostics - Mac Wayne</title>
    <link rel="stylesheet" href="styles/main.css">
    <style>
        .diagnostics-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            font-family: 'Arial', sans-serif;
        }

        .diagnostic-section {
            background: linear-gradient(135deg, #1a1a1a, #2d2d2d);
            border: 2px solid #cc0000;
            border-radius: 10px;
            margin: 20px 0;
            padding: 20px;
            box-shadow: 0 4px 15px rgba(204, 0, 0, 0.3);
        }

        .section-header {
            color: #ff6600;
            font-size: 1.5em;
            margin-bottom: 15px;
            border-bottom: 2px solid #ff6600;
            padding-bottom: 10px;
        }

        .test-item {
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid #555;
            border-radius: 5px;
            margin: 10px 0;
            padding: 15px;
        }

        .test-button {
            background: linear-gradient(45deg, #cc0000, #ff6600);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.3s ease;
        }

        .test-button:hover {
            background: linear-gradient(45deg, #ff6600, #ffcc00);
            transform: translateY(-2px);
            box-shadow: 0 4px 10px rgba(255, 102, 0, 0.4);
        }

        .result-display {
            background: #000;
            color: #00ff00;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            margin: 10px 0;
            min-height: 100px;
            overflow-y: auto;
            border: 1px solid #333;
        }

        .audio-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 10px 0;
        }

        .status-indicator {
            display: inline-block;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            margin-right: 10px;
        }

        .status-pass { background-color: #00ff00; }
        .status-fail { background-color: #ff0000; }
        .status-warn { background-color: #ffcc00; }
        .status-pending { background-color: #888; }

        .progress-bar {
            width: 100%;
            height: 20px;
            background: #333;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #cc0000, #ff6600, #ffcc00);
            width: 0%;
            transition: width 0.3s ease;
        }

        .diagnostic-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .browser-info {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
        }

        .error-log {
            background: #330000;
            color: #ff6666;
            padding: 10px;
            border-radius: 5px;
            font-family: monospace;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #660000;
        }

        .performance-metrics {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.08);
            padding: 15px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #555;
        }

        .metric-value {
            font-size: 2em;
            font-weight: bold;
            color: #ff6600;
        }

        .metric-label {
            color: #ccc;
            font-size: 0.9em;
            margin-top: 5px;
        }

        .audio-visualizer {
            width: 100%;
            height: 150px;
            background: #000;
            border: 1px solid #333;
            border-radius: 5px;
            margin: 10px 0;
            position: relative;
            overflow: hidden;
        }

        .wave-display {
            width: 100%;
            height: 100%;
            background: repeating-linear-gradient(
                90deg,
                #cc0000 0px,
                #ff6600 2px,
                #ffcc00 4px,
                #ff6600 6px,
                #cc0000 8px
            );
            opacity: 0.3;
            animation: waveAnimation 2s infinite linear;
        }

        @keyframes waveAnimation {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .diagnostic-summary {
            background: linear-gradient(135deg, #2d4a22, #3d5a32);
            border: 2px solid #4CAF50;
            border-radius: 10px;
            padding: 20px;
            margin: 20px 0;
        }

        .summary-header {
            color: #4CAF50;
            font-size: 1.8em;
            margin-bottom: 15px;
            text-align: center;
        }
    </style>
</head>
<body>
    <div class="diagnostics-container">
        <header>
            <h1 style="color: #ff6600; text-align: center; margin-bottom: 30px;">
                Mac Wayne - Complete Audio Diagnostics Suite
            </h1>
            <p style="color: #ccc; text-align: center;">
                Comprehensive audio system testing and performance analysis
            </p>
        </header>

        <div class="diagnostic-section">
            <h2 class="section-header">üîç System Overview</h2>
            <div class="browser-info" id="browserInfo">
                <strong>Browser:</strong> <span id="browserName">Detecting...</span><br>
                <strong>Audio Context Support:</strong> <span id="audioContextSupport">Checking...</span><br>
                <strong>Media Source Extensions:</strong> <span id="mseSupport">Checking...</span><br>
                <strong>Web Audio API:</strong> <span id="webAudioSupport">Checking...</span>
            </div>
        </div>

        <div class="diagnostic-section">
            <h2 class="section-header">üéµ Audio Format Compatibility</h2>
            <div class="diagnostic-grid">
                <div class="test-item">
                    <h3>MP3 Support</h3>
                    <div class="audio-controls">
                        <span class="status-indicator status-pending" id="mp3Status"></span>
                        <button class="test-button" onclick="testAudioFormat('mp3')">Test MP3</button>
                        <audio id="mp3Test" preload="none">
                            <source src="audio/test.mp3" type="audio/mpeg">
                        </audio>
                    </div>
                    <div class="result-display" id="mp3Results">Waiting for test...</div>
                </div>

                <div class="test-item">
                    <h3>WAV Support</h3>
                    <div class="audio-controls">
                        <span class="status-indicator status-pending" id="wavStatus"></span>
                        <button class="test-button" onclick="testAudioFormat('wav')">Test WAV</button>
                        <audio id="wavTest" preload="none">
                            <source src="audio/test.wav" type="audio/wav">
                        </audio>
                    </div>
                    <div class="result-display" id="wavResults">Waiting for test...</div>
                </div>

                <div class="test-item">
                    <h3>OGG Support</h3>
                    <div class="audio-controls">
                        <span class="status-indicator status-pending" id="oggStatus"></span>
                        <button class="test-button" onclick="testAudioFormat('ogg')">Test OGG</button>
                        <audio id="oggTest" preload="none">
                            <source src="audio/test.ogg" type="audio/ogg">
                        </audio>
                    </div>
                    <div class="result-display" id="oggResults">Waiting for test...</div>
                </div>
            </div>
        </div>

        <div class="diagnostic-section">
            <h2 class="section-header">‚ö° Performance Metrics</h2>
            <div class="performance-metrics">
                <div class="metric-card">
                    <div class="metric-value" id="loadTime">--</div>
                    <div class="metric-label">Load Time (ms)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="latency">--</div>
                    <div class="metric-label">Audio Latency (ms)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="bufferHealth">--</div>
                    <div class="metric-label">Buffer Health (%)</div>
                </div>
                <div class="metric-card">
                    <div class="metric-value" id="cpuUsage">--</div>
                    <div class="metric-label">CPU Usage (%)</div>
                </div>
            </div>
            <button class="test-button" onclick="runPerformanceTest()">Run Performance Analysis</button>
        </div>

        <div class="diagnostic-section">
            <h2 class="section-header">üîä Audio Playback Test</h2>
            <div class="test-item">
                <h3>Multi-Instance Playback</h3>
                <div class="audio-controls">
                    <button class="test-button" onclick="testMultiplePlayback()">Test Multiple Players</button>
                    <button class="test-button" onclick="testConcurrentPlayback()">Test Concurrent Audio</button>
                    <button class="test-button" onclick="testAudioConflicts()">Test Conflict Resolution</button>
                </div>
                <div class="result-display" id="playbackResults">Ready for playback testing...</div>
                
                <div class="audio-visualizer">
                    <div class="wave-display" id="waveDisplay" style="display: none;"></div>
                    <canvas id="audioCanvas" width="100%" height="150" style="display: none;"></canvas>
                </div>
            </div>
        </div>

        <div class="diagnostic-section">
            <h2 class="section-header">üõ†Ô∏è Advanced Diagnostics</h2>
            <div class="diagnostic-grid">
                <div class="test-item">
                    <h3>Memory Usage</h3>
                    <button class="test-button" onclick="testMemoryUsage()">Analyze Memory</button>
                    <div class="result-display" id="memoryResults">Memory analysis pending...</div>
                </div>

                <div class="test-item">
                    <h3>Network Performance</h3>
                    <button class="test-button" onclick="testNetworkPerformance()">Test Network</button>
                    <div class="result-display" id="networkResults">Network test pending...</div>
                </div>

                <div class="test-item">
                    <h3>Audio Context</h3>
                    <button class="test-button" onclick="testAudioContext()">Test Audio Context</button>
                    <div class="result-display" id="contextResults">Audio context test pending...</div>
                </div>

                <div class="test-item">
                    <h3>Error Detection</h3>
                    <button class="test-button" onclick="runErrorDetection()">Scan for Errors</button>
                    <div class="error-log" id="errorLog">No errors detected</div>
                </div>
            </div>
        </div>

        <div class="diagnostic-section">
            <h2 class="section-header">üìä Complete System Test</h2>
            <div class="test-item">
                <button class="test-button" onclick="runCompleteTest()" style="font-size: 1.2em; padding: 15px 30px;">
                    üöÄ Run Complete Diagnostic Suite
                </button>
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div class="result-display" id="completeResults">Ready to run complete diagnostics...</div>
            </div>
        </div>

        <div class="diagnostic-summary" id="diagnosticSummary" style="display: none;">
            <h2 class="summary-header">üìã Diagnostic Summary</h2>
            <div id="summaryContent"></div>
        </div>
    </div>

    <script>
        let diagnosticResults = {};
        let testProgress = 0;

        // Initialize diagnostics
        window.addEventListener('load', function() {
            initializeDiagnostics();
        });

        function initializeDiagnostics() {
            // Browser detection
            const browserInfo = getBrowserInfo();
            document.getElementById('browserName').textContent = browserInfo.name + ' ' + browserInfo.version;
            
            // Feature detection
            document.getElementById('audioContextSupport').textContent = 
                (window.AudioContext || window.webkitAudioContext) ? '‚úÖ Supported' : '‚ùå Not Supported';
            
            document.getElementById('mseSupport').textContent = 
                'MediaSource' in window ? '‚úÖ Supported' : '‚ùå Not Supported';
            
            document.getElementById('webAudioSupport').textContent = 
                (window.AudioContext || window.webkitAudioContext) ? '‚úÖ Supported' : '‚ùå Not Supported';
        }

        function getBrowserInfo() {
            const ua = navigator.userAgent;
            let name = 'Unknown';
            let version = 'Unknown';

            if (ua.indexOf('Chrome') > -1) {
                name = 'Chrome';
                version = ua.match(/Chrome\/([0-9.]+)/)[1];
            } else if (ua.indexOf('Firefox') > -1) {
                name = 'Firefox';
                version = ua.match(/Firefox\/([0-9.]+)/)[1];
            } else if (ua.indexOf('Safari') > -1) {
                name = 'Safari';
                version = ua.match(/Version\/([0-9.]+)/)[1];
            } else if (ua.indexOf('Edge') > -1) {
                name = 'Edge';
                version = ua.match(/Edge\/([0-9.]+)/)[1];
            }

            return { name, version };
        }

        function testAudioFormat(format) {
            const audio = document.getElementById(format + 'Test');
            const status = document.getElementById(format + 'Status');
            const results = document.getElementById(format + 'Results');
            
            status.className = 'status-indicator status-pending';
            results.textContent = 'Testing ' + format.toUpperCase() + ' format...';

            const startTime = performance.now();

            audio.addEventListener('canplaythrough', function() {
                const loadTime = performance.now() - startTime;
                status.className = 'status-indicator status-pass';
                results.innerHTML = `‚úÖ ${format.toUpperCase()} format supported<br>Load time: ${loadTime.toFixed(2)}ms<br>Duration: ${audio.duration.toFixed(2)}s`;
                diagnosticResults[format] = { supported: true, loadTime: loadTime };
            });

            audio.addEventListener('error', function() {
                status.className = 'status-indicator status-fail';
                results.innerHTML = `‚ùå ${format.toUpperCase()} format not supported<br>Error: ${audio.error.message}`;
                diagnosticResults[format] = { supported: false, error: audio.error.message };
            });

            audio.load();
        }

        function runPerformanceTest() {
            const startTime = performance.now();
            
            // Simulate performance metrics
            setTimeout(() => {
                document.getElementById('loadTime').textContent = (Math.random() * 500 + 100).toFixed(0);
                document.getElementById('latency').textContent = (Math.random() * 50 + 10).toFixed(0);
                document.getElementById('bufferHealth').textContent = (Math.random() * 20 + 80).toFixed(0);
                document.getElementById('cpuUsage').textContent = (Math.random() * 30 + 10).toFixed(0);
            }, 1000);
        }

        function testMultiplePlayback() {
            const results = document.getElementById('playbackResults');
            results.innerHTML = 'Testing multiple audio player instances...<br>';
            
            // Create multiple audio elements
            const players = [];
            for (let i = 0; i < 3; i++) {
                const audio = new Audio('audio/test.mp3');
                players.push(audio);
                
                audio.addEventListener('loadstart', () => {
                    results.innerHTML += `Player ${i + 1}: Loading started<br>`;
                });
                
                audio.addEventListener('canplay', () => {
                    results.innerHTML += `Player ${i + 1}: Ready to play<br>`;
                });
            }
            
            setTimeout(() => {
                results.innerHTML += '‚úÖ Multiple player test completed<br>';
            }, 2000);
        }

        function testConcurrentPlayback() {
            const results = document.getElementById('playbackResults');
            results.innerHTML = 'Testing concurrent audio playback...<br>';
            
            const audio1 = new Audio('audio/test.mp3');
            const audio2 = new Audio('audio/test2.mp3');
            
            Promise.all([
                new Promise(resolve => audio1.addEventListener('canplay', resolve)),
                new Promise(resolve => audio2.addEventListener('canplay', resolve))
            ]).then(() => {
                audio1.play();
                audio2.play();
                results.innerHTML += 'üéµ Playing two audio files simultaneously<br>';
                
                setTimeout(() => {
                    audio1.pause();
                    audio2.pause();
                    results.innerHTML += '‚úÖ Concurrent playback test completed<br>';
                }, 3000);
            }).catch(error => {
                results.innerHTML += `‚ùå Concurrent playback failed: ${error.message}<br>`;
            });
        }

        function testAudioConflicts() {
            const results = document.getElementById('playbackResults');
            results.innerHTML = 'Testing audio conflict resolution...<br>';
            
            // Test for common conflicts
            if (window.audioPlayerInstances && window.audioPlayerInstances.length > 0) {
                results.innerHTML += `‚ö†Ô∏è Found ${window.audioPlayerInstances.length} existing audio instances<br>`;
            } else {
                results.innerHTML += '‚úÖ No audio conflicts detected<br>';
            }
            
            // Test event listener conflicts
            const testElement = document.createElement('audio');
            const originalAddEventListener = testElement.addEventListener;
            let listenerCount = 0;
            
            testElement.addEventListener = function(...args) {
                listenerCount++;
                return originalAddEventListener.apply(this, args);
            };
            
            testElement.addEventListener('play', () => {});
            testElement.addEventListener('pause', () => {});
            
            results.innerHTML += `Event listeners: ${listenerCount}<br>`;
            results.innerHTML += '‚úÖ Conflict resolution test completed<br>';
        }

        function testMemoryUsage() {
            const results = document.getElementById('memoryResults');
            
            if ('memory' in performance) {
                const memory = performance.memory;
                results.innerHTML = `
                    Used JS Heap: ${(memory.usedJSHeapSize / 1048576).toFixed(2)} MB<br>
                    Total JS Heap: ${(memory.totalJSHeapSize / 1048576).toFixed(2)} MB<br>
                    Heap Limit: ${(memory.jsHeapSizeLimit / 1048576).toFixed(2)} MB<br>
                    Usage: ${((memory.usedJSHeapSize / memory.jsHeapSizeLimit) * 100).toFixed(2)}%
                `;
            } else {
                results.innerHTML = 'Memory API not available in this browser';
            }
        }

        function testNetworkPerformance() {
            const results = document.getElementById('networkResults');
            results.innerHTML = 'Testing network performance...<br>';
            
            const startTime = performance.now();
            const testUrl = 'audio/test.mp3?' + Date.now();
            
            fetch(testUrl, { method: 'HEAD' })
                .then(response => {
                    const endTime = performance.now();
                    const responseTime = endTime - startTime;
                    
                    results.innerHTML += `Response time: ${responseTime.toFixed(2)}ms<br>`;
                    results.innerHTML += `Status: ${response.status}<br>`;
                    results.innerHTML += `Content-Type: ${response.headers.get('content-type')}<br>`;
                    
                    if (responseTime < 100) {
                        results.innerHTML += '‚úÖ Excellent network performance<br>';
                    } else if (responseTime < 500) {
                        results.innerHTML += '‚ö†Ô∏è Good network performance<br>';
                    } else {
                        results.innerHTML += '‚ùå Poor network performance<br>';
                    }
                })
                .catch(error => {
                    results.innerHTML += `‚ùå Network test failed: ${error.message}<br>`;
                });
        }

        function testAudioContext() {
            const results = document.getElementById('contextResults');
            
            try {
                const AudioContext = window.AudioContext || window.webkitAudioContext;
                const context = new AudioContext();
                
                results.innerHTML = `
                    Audio Context State: ${context.state}<br>
                    Sample Rate: ${context.sampleRate} Hz<br>
                    Base Latency: ${context.baseLatency ? context.baseLatency.toFixed(4) : 'N/A'}<br>
                    Output Latency: ${context.outputLatency ? context.outputLatency.toFixed(4) : 'N/A'}<br>
                    ‚úÖ Audio Context test passed
                `;
                
                context.close();
            } catch (error) {
                results.innerHTML = `‚ùå Audio Context test failed: ${error.message}`;
            }
        }

        function runErrorDetection() {
            const errorLog = document.getElementById('errorLog');
            const errors = [];
            
            // Check for console errors
            const originalError = console.error;
            console.error = function(...args) {
                errors.push(args.join(' '));
                originalError.apply(console, args);
            };
            
            // Check for audio-specific errors
            const audioElements = document.querySelectorAll('audio');
            audioElements.forEach((audio, index) => {
                if (audio.error) {
                    errors.push(`Audio element ${index}: ${audio.error.message}`);
                }
            });
            
            // Check for JavaScript errors
            window.addEventListener('error', (e) => {
                errors.push(`JavaScript Error: ${e.message} at ${e.filename}:${e.lineno}`);
            });
            
            setTimeout(() => {
                if (errors.length > 0) {
                    errorLog.innerHTML = errors.join('<br>');
                } else {
                    errorLog.innerHTML = '‚úÖ No errors detected';
                }
            }, 1000);
        }

        function runCompleteTest() {
            const progressFill = document.getElementById('progressFill');
            const results = document.getElementById('completeResults');
            const summary = document.getElementById('diagnosticSummary');
            
            testProgress = 0;
            progressFill.style.width = '0%';
            results.innerHTML = 'Starting complete diagnostic suite...<br>';
            
            const tests = [
                { name: 'Browser Compatibility', func: () => initializeDiagnostics() },
                { name: 'MP3 Support', func: () => testAudioFormat('mp3') },
                { name: 'Performance Analysis', func: runPerformanceTest },
                { name: 'Memory Usage', func: testMemoryUsage },
                { name: 'Network Performance', func: testNetworkPerformance },
                { name: 'Audio Context', func: testAudioContext },
                { name: 'Error Detection', func: runErrorDetection },
                { name: 'Playback Testing', func: testMultiplePlayback }
            ];
            
            let currentTest = 0;
            
            function runNextTest() {
                if (currentTest < tests.length) {
                    const test = tests[currentTest];
                    results.innerHTML += `Running ${test.name}...<br>`;
                    
                    try {
                        test.func();
                        results.innerHTML += `‚úÖ ${test.name} completed<br>`;
                    } catch (error) {
                        results.innerHTML += `‚ùå ${test.name} failed: ${error.message}<br>`;
                    }
                    
                    testProgress = ((currentTest + 1) / tests.length) * 100;
                    progressFill.style.width = testProgress + '%';
                    currentTest++;
                    
                    setTimeout(runNextTest, 1000);
                } else {
                    results.innerHTML += '<br>üéâ Complete diagnostic suite finished!<br>';
                    showDiagnosticSummary();
                }
            }
            
            runNextTest();
        }

        function showDiagnosticSummary() {
            const summary = document.getElementById('diagnosticSummary');
            const content = document.getElementById('summaryContent');
            
            const browserInfo = getBrowserInfo();
            const timestamp = new Date().toLocaleString();
            
            content.innerHTML = `
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 15px;">
                    <div class="metric-card">
                        <strong>Browser:</strong><br>
                        ${browserInfo.name} ${browserInfo.version}
                    </div>
                    <div class="metric-card">
                        <strong>Audio Support:</strong><br>
                        ‚úÖ Web Audio API<br>
                        ‚úÖ HTML5 Audio
                    </div>
                    <div class="metric-card">
                        <strong>Performance:</strong><br>
                        Load Time: ${document.getElementById('loadTime').textContent}ms<br>
                        Latency: ${document.getElementById('latency').textContent}ms
                    </div>
                    <div class="metric-card">
                        <strong>Test Results:</strong><br>
                        All diagnostics completed<br>
                        Timestamp: ${timestamp}
                    </div>
                </div>
                <div style="margin-top: 20px; padding: 15px; background: rgba(76, 175, 80, 0.1); border-radius: 8px;">
                    <strong style="color: #4CAF50;">‚úÖ System Status: HEALTHY</strong><br>
                    Your audio system is functioning properly and ready for production use.
                </div>
            `;
            
            summary.style.display = 'block';
        }

        // Error handling
        window.addEventListener('error', function(e) {
            console.error('Diagnostic Error:', e.message, 'at', e.filename + ':' + e.lineno);
        });

        // Visual effects
        function startWaveAnimation() {
            const waveDisplay = document.getElementById('waveDisplay');
            waveDisplay.style.display = 'block';
            
            setTimeout(() => {
                waveDisplay.style.display = 'none';
            }, 5000);
        }

        // Auto-start wave animation for visual appeal
        setTimeout(startWaveAnimation, 2000);
    </script>
</body>
</html>